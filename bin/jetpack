#!/usr/bin/env Rscript

version <- "0.1.2"

tryLoad <- function(lib) {
  requireNamespace(lib, quietly=TRUE)
}

if (tryLoad("packrat")) {
  packrat::off()
}

currentVersion <- as.character(packageVersion("jetpack"))

if (!tryLoad("jetpack") || compareVersion(currentVersion, version) < 0) {
  message("Upgrading Jetpack dependencies...")
  message("This may take a while, but only happens once.")

  if (!tryLoad("devtools")) {
    install.packages("devtools", repos="https://cloud.r-project.org/", quiet=TRUE)
    tryLoad("devtools")
  }

  devtools::install_github("ankane/jetpack", ref=paste0("v", version), repos="https://cloud.r-project.org/", quiet=TRUE)
}

library(jetpack)
jetpack.cli()
